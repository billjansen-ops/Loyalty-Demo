<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CSR Member Activity</title><style>body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f7fb;color:#111}.container{max-width:1100px;margin:40px auto;padding:0 16px}.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.hgroup{display:flex;flex-direction:column;gap:4px}.h1{font-size:22px;font-weight:600}.h2{font-size:14px;color:#555}.controls{display:flex;gap:8px;align-items:center}input[type="date"]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;background:#fff}button.primary{padding:10px 14px;border:0;border-radius:10px;background:#1e66ff;color:#fff;font-weight:600;cursor:not-allowed;opacity:.6}.card{background:#fff;border:1px solid #e7e8ef;border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.05)}.table{width:100%;border-collapse:separate;border-spacing:0}.th,.td{padding:14px}.th{font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:#666;border-bottom:1px solid #ececf3}.row+.row .td{border-top:1px solid #f1f2f7}.datecol{width:160px;white-space:nowrap;color:#222}.detailcol{width:auto}.pointscol{width:160px;text-align:right;font-variant-numeric:tabular-nums}.empty{padding:32px 20px;color:#444;text-align:center}</style></head><body><div class="container"><div class="header"><div class="hgroup"><div class="h1" id="memberTitle">Member Activity</div><div class="h2" id="memberSubtitle"></div></div><div class="controls"><input type="date" id="fromDate"><input type="date" id="toDate"><button class="primary" id="addBtn" title="Enabled in next step">Add Activity</button></div></div><div class="card"><table class="table"><thead><tr><th class="th datecol">Activity Date</th><th class="th detailcol">Details</th><th class="th pointscol" id="pointsHeader">Miles</th></tr></thead><tbody id="rows"></tbody></table><div class="empty" id="emptyState" style="display:none">No activity yet.</div><div class="empty" id="errorState" style="display:none">Unable to load activity.</div></div></div><script>(function(){function qs(k){return new URLSearchParams(location.search).get(k)}function fmtDateISOtoUS(s){try{const d=new Date(s);const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');const y=d.getFullYear();return m+'/'+day+'/'+y}catch(e){return s}}const memberId=qs("member_id")||qs("memberId");const memberName=qs("name")||"";const title=document.getElementById("memberTitle");const sub=document.getElementById("memberSubtitle");const rows=document.getElementById("rows");const empty=document.getElementById("emptyState");const errorBox=document.getElementById("errorState");const pointsHeader=document.getElementById("pointsHeader");const fromInput=document.getElementById("fromDate");const toInput=document.getElementById("toDate");if(!memberId){title.textContent="Member Activity";sub.textContent="Missing member_id in URL.";document.getElementById("addBtn").disabled=true;return}title.textContent=memberName?memberName:"Member Activity";sub.textContent="Member ID "+memberId;const today=new Date();const toStr=today.toISOString().slice(0,10);const from=new Date();from.setDate(from.getDate()-365);const fromStr=from.toISOString().slice(0,10);fromInput.value=fromStr;toInput.value=toStr;const api="http://127.0.0.1:4001";const urls=[api+"/v1/member/"+encodeURIComponent(memberId)+"/activity?from="+fromStr+"&to="+toStr+"&page=1&page_size=25",api+"/v1/members/"+encodeURIComponent(memberId)+"/activities?from="+fromStr+"&to="+toStr+"&page=1&page_size=25"];function tryFetch(list,ix){if(ix>=list.length)return Promise.reject(new Error("no-endpoint"));return fetch(list[ix],{credentials:"omit"}).then(r=>{if(!r.ok)throw new Error("HTTP "+r.status);return r.json()}).catch(()=>tryFetch(list,ix+1))}rows.innerHTML="";empty.style.display="none";errorBox.style.display="none";tryFetch(urls,0).then(data=>{const label=(data&&data.points_label)||"Miles";pointsHeader.textContent=label;const items=Array.isArray(data)?data:(Array.isArray(data&&data.items)?data.items:[]);if(items.length===0){empty.style.display="block";return}const frag=document.createDocumentFragment();items.forEach(it=>{const tr=document.createElement("tr");tr.className="row";const tdDate=document.createElement("td");tdDate.className="td datecol";tdDate.textContent=fmtDateISOtoUS(it.activity_date);const tdDetail=document.createElement("td");tdDetail.className="td detailcol";const parts=[];if(it.carrier)parts.push("Carrier: "+it.carrier);if(it.origin)parts.push("Origin: "+it.origin);if(it.destination)parts.push("Destination: "+it.destination);tdDetail.textContent=parts.join("  ");const tdPoints=document.createElement("td");tdPoints.className="td pointscol";tdPoints.textContent=(it.points!=null?String(it.points):"");tr.appendChild(tdDate);tr.appendChild(tdDetail);tr.appendChild(tdPoints);frag.appendChild(tr)});rows.appendChild(frag)}).catch(()=>{errorBox.style.display="block"})})();</script><script src="activity-pretty.js"></script>
</body></html>
